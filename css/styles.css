:root{
  --bg:#0c1118; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937;
  --primary:#7aa2ff; --success:#34d399; --warning:#fbbf24; --danger:#f87171; --accent:#a78bfa;
  --card:#0b1220; --shadow:0 10px 24px rgba(0,0,0,.35);
  --ok:#34d399; --warn:#fbbf24; --hairline:rgba(148,163,184,.18);
}
html[data-theme="light"]{
  --bg:#f6f7fb; --panel:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
  --primary:#3b82f6; --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --accent:#8b5cf6;
  --card:#fafafa; --shadow:0 10px 20px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif}
header{position:sticky;top:0;background:linear-gradient(180deg, rgba(0,0,0,.08), transparent), var(--bg);backdrop-filter:saturate(1.1) blur(8px);z-index:20}
.topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid var(--border)}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand .logo{width:28px;height:28px;border-radius:10px;
  background: radial-gradient(80% 80% at 30% 20%, rgba(255,255,255,.25), transparent 60%),
              linear-gradient(135deg,var(--primary),var(--accent));
  display:grid; place-items:center;
  transition: transform .2s ease;
}
/* Neutraliza el pseudo-elemento del logo para no superponer texto */
.brand .logo::after{
  content: none !important;
}
.brand .logo:hover{ transform: translateY(-1px) scale(1.02) }

.brand .app-name{
  font-weight:800;
  letter-spacing:.2px;
}
.bar-actions{display:flex;gap:10px;align-items:center}
.chip{padding:6px 10px;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:12px}
.btn{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;border:none}
.btn.success{background:linear-gradient(135deg,var(--success),#059669);color:white;border:none}
.btn.ghost{background:transparent;box-shadow:none}
input, select, textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px}
input:focus, textarea:focus{outline:2px solid var(--primary);outline-offset:1px}
.search{min-width:260px}
.tabs{display:flex;gap:6px;align-items:center;padding:10px 16px;border-bottom:1px solid var(--border)}
.tab{padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted)}
.tab.active{color:var(--text);background:var(--panel);box-shadow:var(--shadow)}
main{padding:16px;max-width:1400px;margin:0 auto}
.main-grid{display:grid;grid-template-columns:260px 1fr;gap:14px;align-items:start}
#projectsSidebar{position:sticky;top:96px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:10px;box-shadow:var(--shadow);max-height:75vh;overflow:auto}
#projectsSidebar .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
#projectsSidebar .proj-list{display:flex;flex-direction:column;gap:6px}
#projectsSidebar .proj{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px solid var(--border);border-radius:10px;padding:6px 8px;cursor:pointer}
#projectsSidebar .proj.active{outline:2px solid var(--primary)}
#projectsSidebar .proj .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#projectsSidebar .proj .x{opacity:.7;cursor:pointer}
#projectsSidebar .create{display:flex;gap:6px;margin-top:8px}
/* Favoritos zona */
.fav-zone{display:flex;flex-direction:column;gap:6px;padding:4px;border:1px dashed var(--hairline);border-radius:10px;min-height:38px}
.fav-zone .proj{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent)}

.view-flex{display:grid;grid-template-columns:1.4fr .9fr;gap:12px}

.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;box-shadow:var(--shadow)}
.h{font-weight:800;margin:0 0 8px 0}

/* Board */
.board{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:14px}
.column{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;min-height:260px;display:flex;flex-direction:column}
.col-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.col-title{font-weight:700}
.dropzone{flex:1;display:flex;flex-direction:column;gap:10px;padding:4px;border-radius:12px;min-height:160px}
.dropzone.drag{outline:2px dashed var(--primary)}
.task{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;box-shadow:var(--shadow);cursor:grab;position:relative}
.task header{display:flex;justify-content:space-between;align-items:center}
.task h4{margin:0;font-size:14px;cursor:pointer}
.task .meta{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:12px;margin-top:6px;flex-wrap:wrap}
.task .meta .start-date{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:2px 8px;
  border:1px solid var(--border);
  border-radius:999px;
  font-size:11px;
  color:var(--muted);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.task .meta .start-date::before{
  content:"Inicio";
  color:var(--text);
  font-weight:600;
  margin-right:2px;
}

/* Auto-inject pill si SOLO existe el atributo (no elemento explícito) */
.task[data-start] .meta:not(:has(.start-date))::after,
.task[data-start-date] .meta:not(:has(.start-date))::after,
.task[data-startDate] .meta:not(:has(.start-date))::after,
.task[data-inicio] .meta:not(:has(.start-date))::after{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:2px 8px;
  border:1px solid var(--border);
  border-radius:999px;
  font-size:11px;
  color:var(--muted);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  font-weight:400;
}

/* Contenido específico según atributo presente */
.task[data-start] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start) }
.task[data-start-date] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start-date) }
.task[data-startDate] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-startDate) }
.task[data-inicio] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-inicio) }

.icons{display:flex;gap:6px}
.row-actions{position:absolute;right:8px;bottom:8px;opacity:0;transition:opacity .15s}
.task:hover .row-actions{opacity:1}

/* Tablas: filas cerradas */
tr.closed td{ color: var(--muted); background: linear-gradient(180deg, rgba(16,185,129,.08), transparent); }
tr.closed td:first-child{ position: relative }
tr.closed td:first-child::before{ content:''; position:absolute; left:8px; top:50%; width:8px; height:8px; background:var(--success); border-radius:50%; transform:translateY(-50%)}

/* Tag input */
.tagbox{display:flex;gap:6px;flex-wrap:wrap;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px}
.tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);padding:3px 8px;border-radius:999px}
.tag .x{cursor:pointer;opacity:.7}
.tagbox input{border:none;outline:none;background:transparent;padding:4px 6px;min-width:100px}

/* Dialog (task card) */
dialog{border:none;border-radius:18px;background:var(--panel);color:var(--text);box-shadow:var(--shadow);width:min(860px,95vw)}
dialog::backdrop{background:rgba(0,0,0,.45)}
.sheet{display:grid;grid-template-columns:1.3fr .7fr;gap:14px}
.sheet-head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.dot{width:10px;height:10px;border-radius:50%;background:var(--primary)}
.h-title{font-size:22px;font-weight:800;margin:0}
.meta-bar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.meta-bar .chip{border-radius:999px}
.aside{border-left:1px solid var(--border);padding-left:10px;display:grid;gap:8px}
.inline-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.r{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.sub-list{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.sub-row{display:flex;gap:8px;align-items:center}
.sub-row input[type="text"]{flex:1}
.footer-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Docs */
.docs{display:grid;grid-template-columns:280px 1fr;gap:12px}
.tree{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:8px;max-height:70vh;overflow:auto}
.tree ul{list-style:none;padding-left:12px}
.tree li{margin:4px 0}
.tree .node{display:flex;align-items:center;gap:6px}
.doc-editor{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
.ribbon{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px 0}
.rich{min-height:320px;border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card);outline:none}
.rich img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
.cmd{position:absolute;background:var(--panel);border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);padding:6px;display:none;z-index:50}
.cmd button{display:block;width:100%;text-align:left;border:none;background:transparent;padding:6px 8px;cursor:pointer}
.cmd button:hover{background:var(--card)}

/* Summary */
.cards{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:12px}
.progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden}
.progress > div{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent))}
.bar{height:12px;background:linear-gradient(180deg,var(--primary),var(--accent));border-radius:10px;position:relative}
.tooltip{position:absolute;left:50%;top:-34px;transform:translateX(-50%);background:var(--panel);border:1px solid var(--border);padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap;display:none}
.bar:hover .tooltip{display:block}

/* Confetti */
.confetti{position:fixed;top:-10px;left:0;width:100%;pointer-events:none;z-index:9999}
.confetti i{position:absolute;width:10px;height:14px;background:var(--primary);opacity:.9;will-change:transform,opacity;border-radius:2px}
@keyframes fall{to{transform:translateY(105vh) rotate(720deg);opacity:.9}}

/* Mega (center) */
.mega{position:fixed;inset:0;display:none;place-items:center;z-index:10000;background:rgba(0,0,0,.5)}
.mega.show{display:grid}
.mega .inner{max-width:min(900px,92vw);text-align:center;padding:28px 22px;border-radius:16px;
  color:white;font-weight:900;letter-spacing:.3px;
  background:radial-gradient(1200px 400px at 50% 50%, rgba(96,165,250,.25), rgba(167,139,250,.18) 60%, transparent 80%),
             linear-gradient(135deg, rgba(96,165,250,.95), rgba(167,139,250,.95));
  box-shadow:0 20px 70px rgba(0,0,0,.55); 
  font-size:clamp(26px, 5.6vw, 62px);
  animation:pop .45s cubic-bezier(.2,.9,.2,1) both;
  position:relative;
}
.mega .close{position:absolute;right:10px;top:10px;background:rgba(0,0,0,.25);border:none;color:white;border-radius:8px;padding:6px 10px;cursor:pointer}
@keyframes pop{0%{transform:scale(.92);opacity:0}70%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}}

footer{padding:30px;color:var(--muted);text-align:center}

@media (max-width: 980px){
  .board{grid-template-columns:1fr}
  .docs{grid-template-columns:1fr}
  .sheet{grid-template-columns:1fr}
  .cards{grid-template-columns:1fr 1fr}
  .view-flex{grid-template-columns:1fr}
  .main-grid{grid-template-columns:1fr}
  #projectsSidebar{position:static;max-height:none}
}

/* Modern tokens and light polish (non-breaking) */
:root{ --radius:12px; --pad:8px; --fontScale:100% }
body{ font-size: var(--fontScale) }
.btn{ padding: calc(var(--pad) - 2px) calc(var(--pad) + 4px); border-radius: var(--radius); transition:transform .12s ease, background .2s, border-color .2s }
input, select, textarea{ padding: var(--pad); border-radius: calc(var(--radius) - 2px) }
.tab{ border-radius: var(--radius) }
#projectsSidebar{ border-radius: var(--radius) }
.column{ border-radius: var(--radius) }
.dropzone{ border-radius: calc(var(--radius) - 2px) }
.task{ border-radius: calc(var(--radius) + 2px) }
.card{ background: linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--panel) }
.chip, .tag{ background: linear-gradient(180deg, rgba(255,255,255,.04), transparent) }

/* Accesibilidad y motion */
*:focus-visible{ outline:2px solid var(--primary); outline-offset:2px }
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{ animation: none !important; transition: none !important }
}

/* Asegura que el pill de inicio aparezca de forma consistente */
.task[data-start] .meta::after{
  /* ya definido antes si usas :not(:has(.start-date)); este refuerzo asegura orden */
  order:0;
}

.start-pill{ position:relative }
.start-pill::before{
  content:"Inicio";
  font-weight:600;
  color:var(--text);
  margin-right:4px;
  opacity:.9;
}

/* ---- Closed state visuals ---- */
.task.closed{opacity:.85;border-color:rgba(16,185,129,.35);box-shadow:inset 0 0 0 2px rgba(16,185,129,.25)}
.task.closed header h4::after{content:' ✔'; color:var(--success); font-weight:700}
/* Tablas: filas cerradas */
tr.closed td{ color: var(--muted); background: linear-gradient(180deg, rgba(16,185,129,.08), transparent); }
tr.closed td:first-child{ position: relative }
tr.closed td:first-child::before{ content:''; position:absolute; left:8px; top:50%; width:8px; height:8px; background:var(--success); border-radius:50%; transform:translateY(-50%)}

/* ===================== DESIGN TOKENS (Dark / Light) ===================== */
:root{
  /* Superficies */
  --bg:#070b1a;
  --panel:#0b1020;
  --panel-2:#0a1324;
  --card:#0d152b;

  /* Texto */
  --text:#EAF1FF;
  --muted:#9DB2D7;

  /* Bordes/sombras */
  --border:#1b2a44;
  --hairline:rgba(157,178,215,.22);
  --elev-1:0 8px 24px rgba(7,12,26,0.55);
  --shadow:0 10px 24px rgba(7,12,26,0.55);

  /* Marca / acentos */
  --primary:#9A6BFF;      /* violeta */
  --primary-600:#7F5BFF;  /* violeta intenso */
  --accent:#49E0FF;       /* cian */
  --info:#49E0FF;
  --success:#30E0A1;
  --warning:#F6C760;
  --danger:#FF6B8B;

  /* Utilidades */
  --ok:#30E0A1; --warn:#F6C760;
  --radius-1:10px; --radius-2:14px; --radius-pill:999px;
  --space-1:8px; --space-2:12px; --space-3:16px; --space-4:24px;
  --font-sans: ui-sans-serif, Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;

  /* Neon presets */
  --neon-grad: linear-gradient(45deg, #9A6BFF 0%, #49E0FF 100%);
  --rail-grad: linear-gradient(90deg, #FF5BD0, #9A6BFF, #49E0FF);
  --focus:#9A6BFF;

  /* Card glows */
  --card-glow-top: radial-gradient(120% 80% at 50% 0%, rgba(255,91,208,.14), transparent 60%);
  --card-glow-side: radial-gradient(60% 120% at 100% 50%, rgba(73,224,255,.10), transparent 60%);

  /* Keycaps */
  --keycap-bg: rgba(157,178,215,.12);
  --keycap-brd: rgba(157,178,215,.28);
  --keycap-tx: #D4E0F7;

  /* Tabs */
  --tab-off-bg: rgba(255,255,255,.04);
  --tab-off-tx: var(--muted);
  --tab-on-bg: rgba(154,107,255,.18);
  --tab-on-brd: rgba(154,107,255,.45);
  --tab-on-tx: var(--text);

  /* Mic */
  --mic-off:#95A6C7;
  --mic-on-1:#2FE2F0;
  --mic-on-2:#A384FF;

  /* Listening sweep (blue → purple, no pink/aqua) */
  --listen-blue:#3B82F6;   /* azul */
  --listen-indigo:#6366F1; /* índigo */
  --listen-violet:#8B5CF6; /* violeta */
}
/* Animate-able custom property for neon angle */
@property --neon-angle{
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}
html[data-theme="light"]{
  --bg:#F6F8FF; --panel:#FFFFFF; --panel-2:#F4F7FF; --card:#FFFFFF;
  --text:#0E1530; --muted:#6E7F9F; --border:#E1E7F5; --hairline:rgba(14,21,48,.10);
  --primary:#7F5BFF; --primary-600:#6C4BF6; --accent:#3BBEF0; --info:#3BBEF0;
  --success:#16D39A; --warning:#E9B64F; --danger:#F65C7A;
  --elev-1:0 6px 18px rgba(14,21,48,.08);
  --shadow:0 10px 20px rgba(14,21,48,.08);
  --neon-grad: linear-gradient(45deg, #7F5BFF 0%, #3BBEF0 100%);
  --rail-grad: linear-gradient(90deg, #FF66D6, #7F5BFF, #3BBEF0);
  --focus:#7F5BFF;

  /* Card glows (light) */
  --card-glow-top: radial-gradient(120% 80% at 50% 0%, rgba(255,102,214,.10), transparent 60%);
  --card-glow-side: radial-gradient(60% 120% at 100% 50%, rgba(59,190,240,.08), transparent 60%);

  /* Keycaps */
  --keycap-bg: rgba(14,21,48,.06);
  --keycap-brd: rgba(14,21,48,.14);
  --keycap-tx: #3F4E74;

  /* Tabs */
  --tab-off-bg: rgba(14,21,48,.04);
  --tab-off-tx: var(--muted);
  --tab-on-bg: rgba(127,91,255,.18);
  --tab-on-brd: rgba(127,91,255,.45);
  --tab-on-tx: var(--text);

  /* Listening sweep (light theme) */
  --listen-blue:#3B82F6;
  --listen-indigo:#6366F1;
  --listen-violet:#8B5CF6;
}

/* ============== Base & A11y ============== */
*{box-sizing:border-box}
html, body{
  font-family: var(--font-sans);
  color: var(--text);
  background: var(--bg);
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
body{margin:0}

/* Focus global + motion */
*:focus-visible{ outline:2px solid var(--focus); outline-offset:2px }
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{ animation: none; transition: none }
}
*{ transition: background-color .12s ease, color .12s ease, border-color .12s ease; }
@media (prefers-reduced-motion: reduce){ *{ transition: none} }

/* ============== Buttons / Inputs / Chips ============== */
.btn{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);font-weight:600;transition:transform .12s ease, background .2s, border-color .2s}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none}
.btn.success{background:linear-gradient(135deg,var(--success),#059669);color:#fff;border:none}
.btn.ghost{background:transparent;box-shadow:none}
input, select, textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px}
input:focus, select:focus, textarea:focus{outline:2px solid var(--primary);outline-offset:2px}
.chip{padding:6px 10px;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:12px}

/* Keycap utility */
.keycap{display:inline-flex;align-items:center;justify-content:center;min-width:20px;padding:2px 6px;border-radius:6px;border:1px solid var(--keycap-brd);background:var(--keycap-bg);color:var(--keycap-tx);font-size:12px;line-height:1}

/* Neon border utility */
.neon-border{ position:relative; }
.neon-border::after{
  content:""; position:absolute; inset:0; border-radius:inherit; padding:1px; pointer-events:none; background: var(--neon-grad);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity:.28;
}

/* ============== Header (neon-glass) ============== */
header{position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,.06), transparent), var(--panel);backdrop-filter:saturate(1.1) blur(8px);-webkit-backdrop-filter:saturate(1.1) blur(8px);z-index:3000}
html[data-theme="light"] header{background:linear-gradient(180deg, rgba(0,0,0,.05), transparent), var(--panel)}
.app-header{
  display:grid; grid-template-columns: 1fr minmax(360px,720px) 1fr; gap: var(--space-3);
  align-items:center; padding:20px 24px 16px; height:9rem; box-sizing:border-box;
  box-shadow: 0 1px 0 rgba(255,255,255,.02) inset, 0 10px 24px rgba(2,6,23,.08) inset;
}
.h-left,.h-center,.h-right{ display:flex; align-items:center; gap: var(--space-2); }

/* Branding */
.logo-btn{ display:flex; align-items:center; gap:10px; color:var(--text); cursor:pointer; padding:6px 12px; border-radius:12px; border:1px solid var(--hairline);
  background: radial-gradient(80% 80% at 20% 20%, rgba(255,255,255,.12), transparent 60%), linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  position:relative; transition: background-color .18s ease, box-shadow .18s ease; min-height:44px; min-width:44px;
}
/* Make orb icon bigger without affecting layout */
.logo-btn .logo-svg{ width:34px; height:34px }
.logo-btn:hover{ background: radial-gradient(80% 80% at 20% 20%, rgba(255,255,255,.16), transparent 60%), linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0)); }
.logo-btn::after{ content:""; position:absolute; inset:0; border-radius:inherit; padding:1px; pointer-events:none; background: var(--neon-grad);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity:.28 }
.logo-btn::before{ content:""; position:absolute; inset:-6px; border-radius:inherit; pointer-events:none; filter:blur(6px); opacity:.08;
  background: radial-gradient(60% 60% at 50% 50%, color-mix(in oklab, var(--accent), transparent 90%), transparent 70%); }
.brand{ font-weight:700; letter-spacing:.2px; }
.badge{ font-size:12px; padding:2px 8px; border-radius: var(--radius-pill); background: rgba(139,92,246,.2); color: var(--primary); border:1px solid rgba(139,92,246,.35); }
/* Bigger wordmark */
.app-header .wordmark{ font-weight:700; font-size:18px }

/* Search (input central) */
.search-wrap{
  position:relative; flex:1; display:flex; align-items:center;
  background: var(--panel-2); border:1px solid var(--border);
  border-radius: var(--radius-2); padding: 6px 12px; gap:8px; min-height:40px;
  box-shadow: var(--elev-1);
  background-image: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
  outline: 1px solid transparent;
  max-width: 640px; transition: max-width .18s ease, box-shadow .12s ease, border-color .12s ease;
}
.search-wrap.listening{ --neon-angle: 0deg; }
.search-wrap.listening{
  border-color: transparent; /* border is provided by ::after */
}
.search-wrap.listening::after{
  content:""; position:absolute; inset:0; border-radius: inherit; padding:1.5px;
  /* Purple-dominant sweep with subtle blue accents (no pink/aqua) */
  background: conic-gradient(
    from var(--neon-angle, 0deg),
    var(--listen-blue) 0deg 36deg,     /* ~10% blue lead-in */
    var(--listen-indigo) 36deg 90deg,  /* brief indigo bridge */
    var(--primary) 90deg 300deg,       /* dominant purple span */
    var(--listen-violet) 300deg 342deg,/* gentle violet tail */
    var(--listen-blue) 342deg 360deg   /* close with a hint of blue */
  );
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  pointer-events:none; opacity:.95; filter: saturate(1.1);
  animation: neonSweep 2.2s linear infinite;
}
.search-wrap.listening::before{
  content:""; position:absolute; inset:-6px; border-radius:inherit; pointer-events:none;
  /* Matching purple/blue ambient glow, removing pink & aqua */
  background: radial-gradient(60% 100% at 50% 0%, color-mix(in oklab, var(--listen-indigo), transparent 88%), transparent 70%),
              radial-gradient(100% 60% at 100% 50%, color-mix(in oklab, var(--primary), transparent 88%), transparent 70%),
              radial-gradient(100% 60% at 0% 50%, color-mix(in oklab, var(--listen-blue), transparent 92%), transparent 70%);
  filter: blur(10px); opacity:.45; animation: neonPulse 1.8s ease-in-out infinite;
}
/* Animate the angle instead of rotating the element */
@keyframes neonSweep{
  from{ --neon-angle: 0deg }
  to{ --neon-angle: 360deg }
}
@keyframes neonPulse{ 0%,100%{ opacity:.38 } 50%{ opacity:.55 } }
@media (prefers-reduced-motion: reduce){
  .search-wrap.listening::after{ animation: none }
  .search-wrap.listening::before{ animation: none }
}
.search-wrap.expanded{ max-width: 920px; }
.search-wrap:focus-within{
  border-color: color-mix(in oklab, var(--primary), transparent 50%);
  box-shadow: 0 0 0 1px color-mix(in oklab, var(--primary), transparent 35%), 0 4px 18px rgba(2,6,23,.18);
}
.search-wrap .s-icon-btn{
  background: transparent; border: 0; padding: 0; margin-right: 6px; opacity: .9;
  color: var(--text); cursor: pointer; display: inline-flex; align-items: center; line-height: 1;
}
.search-wrap .s-icon-btn:hover{ opacity:1 }
.search-wrap .s-icon-btn:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; border-radius:6px }
.search-wrap input{ background:transparent; border:0; color:var(--text); width:100%; font-size:14px; outline:none }
.search-wrap .s-right{ margin-left:auto; display:flex; align-items:center; gap:8px }
.search-wrap .key{ display:none }
.search-wrap .plus{ display:none }
.search-wrap .s-btn{ border:1px solid var(--hairline); background: rgba(255,255,255,.03); color:var(--text); border-radius:8px; height:28px; padding:0 8px; cursor:pointer; opacity:.92; display:inline-flex; align-items:center; gap:6px }
.search-wrap .s-btn:hover{ background: rgba(255,255,255,.06); opacity:1 }
.search-wrap .s-btn.on{ box-shadow: 0 0 0 1px var(--primary) inset, 0 0 12px color-mix(in oklab, var(--primary), transparent 60%); border-color: var(--primary) }
.search-wrap #micBtn{
  background: transparent; border: 0; padding: 0; margin-right: 6px; cursor: pointer;
  display: inline-flex; align-items: center; line-height: 1; color: var(--text);
}
.search-wrap #micBtn:hover{ opacity: 1 }
.search-wrap #micBtn:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; border-radius:6px }
.search-wrap #micBtn svg{ color: color-mix(in oklab, var(--accent), white 8%); }
.search-wrap #micBtn svg .slash{ opacity:.85 }
.search-wrap #micBtn.on svg{ color: var(--accent); filter: drop-shadow(0 0 6px color-mix(in oklab, var(--accent), transparent 60%)); }
.search-wrap #micBtn.on svg .slash{ opacity:0 }
.s-rail{ position:absolute; left:10px; right:10px; bottom:-2px; height:1px; background: var(--rail-grad); opacity:.6; border-radius:2px; pointer-events:none }

/* Search dropdown */
.s-dd{ position:absolute; left:0; right:0; top:calc(100% + 6px); background: var(--panel); border:1px solid var(--hairline); border-radius: 12px; box-shadow: var(--elev-1); padding:6px; max-height:50vh; overflow:auto; z-index:3200 }
.s-dd[hidden]{ display:none }
.s-dd .item{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 10px; border-radius:10px; cursor:pointer; border:1px solid var(--hairline); background:transparent }
.s-dd .item[aria-selected="true"], .s-dd .item:hover{ background: rgba(255,255,255,.06) }
.s-dd .create-panel{ display:block; text-align:left; padding:12px 12px; border-radius:12px; border:1px solid var(--hairline); background: linear-gradient(180deg, rgba(255,255,255,.03), transparent); margin-bottom:8px }
.s-dd .create-panel .cp-title{ font-weight:600; color:var(--text); margin-bottom:8px }
.s-dd .create-panel .cp-field{ margin-bottom:8px }
.s-dd .create-panel .label{ display:inline-block; font-size:12px; color:var(--muted); margin-bottom:4px }
.s-dd .create-panel .cp-title-preview{ padding:8px 10px; border:1px solid var(--hairline); border-radius:8px; color:var(--text); background:rgba(0,0,0,.12) }
.s-dd .create-panel .cp-chips{ display:flex; align-items:center; gap:8px; margin:8px 0 }
.s-dd .create-panel .cp-chips .chip{ border-radius:999px; background:rgba(255,255,255,.03); border:1px solid var(--hairline); color:var(--text); cursor:pointer }
.s-dd .create-panel .cp-chips .chip.active{ background:rgba(255,255,255,.08) }
.s-dd .create-panel .cp-checklist textarea{ width:100%; resize:vertical; min-height:48px; border-radius:8px; border:1px solid var(--hairline); background:rgba(0,0,0,.12); color:var(--text); padding:8px 10px }
.s-dd .create-panel .cp-actions{ display:flex; justify-content:flex-end; margin-top:10px }

/* ============== Fullscreen Search Modal ============== */
.search-overlay{ position:fixed; inset:0; z-index:3400; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.45); }
.search-modal-slot{ width:min(980px, 92vw); }
.search-modal-slot .search-wrap{
  max-width:none; width:100%; min-height:140px; padding: 20px 22px; border-radius: 16px;
  box-shadow: 0 10px 40px rgba(2,6,23,.35), 0 0 0 1px color-mix(in oklab, var(--primary), transparent 60%);
  transform-origin: center top;
  animation: searchGrow .18s ease-out both;
}
.search-overlay{ animation: fadeBg .18s ease-out both }
.search-overlay.closing{ animation: fadeBgOut .18s ease-in both }
.search-overlay.closing .search-modal-slot .search-wrap{ animation: searchShrink .16s ease-in both }
@keyframes searchGrow{ from{ transform: scale(.96); opacity:.0 } to{ transform: scale(1); opacity:1 } }
@keyframes searchShrink{ from{ transform: scale(1); opacity:1 } to{ transform: scale(.96); opacity:0 } }
@keyframes fadeBg{ from{ background: rgba(0,0,0,.0) } to{ background: rgba(0,0,0,.45) } }
@keyframes fadeBgOut{ from{ background: rgba(0,0,0,.45) } to{ background: rgba(0,0,0,.0) } }
@media (prefers-reduced-motion: reduce){
  .search-overlay, .search-modal-slot .search-wrap{ animation: none !important; }
}
.search-modal-slot .search-wrap .ml-field{
  width:100%; background:transparent; border:0; color:var(--text); resize:none; outline:none;
  font-size:18px; line-height:1.5; min-height:96px; padding: 6px 2px;
}
/* Hide the single-line input while in modal to avoid duplication */
body.search-modal-open .search-modal-slot .search-wrap input#globalSearch{ display:none }
.search-modal-slot .search-wrap input{ font-size:18px; line-height:1.5; padding: 12px 10px }
body.search-modal-open header, body.search-modal-open main, body.search-modal-open footer{
  filter: blur(2px) saturate(.9);
}

/* Right icons (tema, perfil, AI) */
.icon-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px; height:40px; border-radius:10px; border:1px solid var(--hairline);
  background:rgba(255,255,255,.03); color:var(--text);
  opacity:.92; transition:opacity .12s ease, background-color .12s ease, border-color .12s ease;
}
.icon-btn:hover{ background:rgba(255,255,255,.06); opacity:1; }
.icon-btn svg{ width:18px; height:18px; }
.icon-btn:focus-visible{ outline:2px solid var(--primary); outline-offset:2px; }

/* User menu */
.user-menu{ position:relative; }
.user-pill{
  display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius: var(--radius-pill);
  border:1px solid var(--hairline); background: rgba(255,255,255,.03); color:var(--text);
  min-height:40px;
}
.user-pill .dot{ width:8px; height:8px; border-radius:50%; background: var(--success); }
.user-pill .u-name{ font-weight:600; }
.user-pill .u-xp{ color:var(--muted); font-size:12px; }
.user-menu .menu{
  position:absolute; right:0; top:calc(100% + 8px); background: var(--panel);
  border:1px solid var(--hairline); border-radius: var(--radius-1); min-width:220px; padding:6px;
  box-shadow: var(--elev-1); z-index:3300;
}
.user-menu .menu[hidden]{ display:none; }
.user-menu .menu button{
  width:100%; text-align:left; padding:10px 12px; border-radius:8px; background:transparent; border:0; color:var(--text);
}
.user-menu .menu button:hover{ background: rgba(255,255,255,.06); }

/* Responsive header */
@media (max-width: 980px){
  .app-header{ grid-template-columns: 1fr 1.2fr auto; gap: var(--space-2); padding: 16px 20px; height:66px; }
  .badge, .u-xp{ display:none; }
}
@media (max-width: 720px){
  .search-wrap{ max-width:none }
  .search-wrap .key, .search-wrap .plus{ display:none; }
}

/* ===== Tabs (segunda fila / subbar) ===== */
.subbar{
  background: red;
  position: sticky; top:88px; z-index: 900;
  display:grid; grid-template-columns: 1fr auto 1fr; gap:6px; align-items:center;
  padding:24px var(--space-4) 16px; /* extra space to visually separate without borders */
  background: var(--panel); /* unify same color as header */
  -webkit-backdrop-filter: saturate(1.1) blur(6px);
  backdrop-filter: saturate(1.1) blur(6px);
}
html[data-theme="light"] .subbar{ background: var(--panel); }
.subbar .tabs-wrap{ display:flex; gap:6px; align-items:center; grid-column:2; justify-self:center; overflow-x:auto; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; max-width:100% }
.subbar .tab-btn{
  border:1px solid var(--hairline); background: var(--tab-off-bg); color: var(--tab-off-tx);
  padding:6px 10px; border-radius: var(--radius-1); font-size:13px; cursor:pointer; transition: box-shadow .12s, background-color .12s, border-color .12s; scroll-snap-align:center
}
.subbar .tab-btn:hover{ background: rgba(255,255,255,.06); box-shadow: 0 2px 10px rgba(2,6,23,.12) }
.subbar .tab-btn[aria-current="page"]{
  color: var(--tab-on-tx); border-color: var(--tab-on-brd); background: var(--tab-on-bg);
  box-shadow: inset 0 0 0 1px var(--primary), 0 6px 20px rgba(2,6,23,.14);
}
.subbar .sub-actions{ display:flex; gap:8px; align-items:center; grid-column:3; justify-self:end }

/* ============== Sidebar / Layout / Cards ============== */
main{padding:16px;max-width:1400px;margin:0 auto}
.main-grid{display:grid;grid-template-columns:260px 1fr;gap:14px;align-items:start}
#projectsSidebar{position:sticky;top:96px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:10px;box-shadow:var(--shadow);max-height:75vh;overflow:auto}
#projectsSidebar .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
#projectsSidebar .proj-list{display:flex;flex-direction:column;gap:6px}
#projectsSidebar .proj{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px solid var(--border);border-radius:10px;padding:6px 8px;cursor:pointer}
#projectsSidebar .proj.active{outline:2px solid var(--primary)}
#projectsSidebar .proj .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#projectsSidebar .proj .x{opacity:.7;cursor:pointer}
#projectsSidebar .create{display:flex;gap:6px;margin-top:8px}
.fav-zone{display:flex;flex-direction:column;gap:6px;padding:4px;border:1px dashed var(--hairline);border-radius:10px;min-height:38px}
.fav-zone .proj{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent)}

.view-flex{display:grid;grid-template-columns:1.4fr .9fr;gap:12px}
.card{
  background:
    var(--card-glow-top),
    var(--card-glow-side),
    linear-gradient(180deg, rgba(255,255,255,.03), transparent),
    var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  box-shadow:var(--shadow)
}
.h{font-weight:800;margin:0 0 8px 0}

/* ============== Board / Tasks ============== */
.board{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:14px}
.column{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;min-height:260px;display:flex;flex-direction:column}
.col-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.col-title{font-weight:700}
.dropzone{flex:1;display:flex;flex-direction:column;gap:10px;padding:4px;border-radius:12px;min-height:160px}
.dropzone.drag{outline:2px dashed var(--primary)}
.task{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;box-shadow:var(--shadow);cursor:grab;position:relative}
.task.static{ cursor:default }
.task.over{ background:rgba(248,113,113,.08); border-style:dashed; border-color:rgba(248,113,113,.25) }
.task header{display:flex;justify-content:space-between;align-items:center}
.task h4{margin:0;font-size:14px;cursor:pointer}
.task .meta{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:12px;margin-top:6px;flex-wrap:wrap}
.task .meta .start-date{
  display:inline-flex; align-items:center; gap:6px; padding:2px 8px;
  border:1px solid var(--border); border-radius:999px; font-size:11px; color:var(--muted);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.task .meta .start-date::before{ content:"Inicio"; color:var(--text); font-weight:600; margin-right:2px }

/* Auto-pill para "Inicio" si no hay .start-date explícito */
.task[data-start] .meta:not(:has(.start-date))::after,
.task[data-start-date] .meta:not(:has(.start-date))::after,
.task[data-startDate] .meta:not(:has(.start-date))::after,
.task[data-inicio] .meta:not(:has(.start-date))::after{
  display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border:1px solid var(--border); border-radius:999px;
  font-size:11px; color:var(--muted); background:linear-gradient(180deg, rgba(255,255,255,.04), transparent); font-weight:400;
}
.task[data-start] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start) }
.task[data-start-date] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start-date) }
.task[data-startDate] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-startDate) }
.task[data-inicio] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-inicio) }

.icons{display:flex;gap:6px}
.row-actions{position:absolute;right:8px;bottom:8px;opacity:0;transition:opacity .15s}
.task:hover .row-actions{opacity:1}

/* Closed state */
.task.closed{opacity:.85;border-color:rgba(16,185,129,.35);box-shadow:inset 0 0 0 2px rgba(16,185,129,.25)}
.task.closed header h4::after{content:' ✔'; color:var(--success); font-weight:700}

/* Tablas: filas cerradas */
tr.closed td{ color: var(--muted); background: linear-gradient(180deg, rgba(16,185,129,.08), transparent); }
tr.closed td:first-child{ position: relative }
tr.closed td:first-child::before{ content:''; position:absolute; left:8px; top:50%; width:8px; height:8px; background:var(--success); border-radius:50%; transform:translateY(-50%)}

/* ============== Docs ============== */
.docs{display:grid;grid-template-columns:280px 1fr;gap:12px}
.tree{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:8px;max-height:70vh;overflow:auto}
.tree ul{list-style:none;padding-left:12px}
.tree li{margin:4px 0}
.tree .node{display:flex;align-items:center;gap:6px}
.doc-editor{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
.ribbon{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px 0}
.rich{min-height:320px;border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card);outline:none}
.rich img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
.cmd{position:absolute;background:var(--panel);border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);padding:6px;display:none;z-index:50}
.cmd button{display:block;width:100%;text-align:left;border:none;background:transparent;padding:6px 8px;cursor:pointer}
.cmd button:hover{background:var(--card)}

/* ============== Utilities (moved from inline styles in JS) ============== */
/* Spacing */
.hidden{ display:none !important }
.gap-6{ gap:6px }
.gap-10{ gap:10px }
.gap-8{ gap:8px }
.mt-6{ margin-top:6px }
.mt--6{ margin-top:-6px }
.mt-8{ margin-top:8px }
.mt-12{ margin-top:12px }
.mt-10{ margin-top:10px }
.mb-6{ margin-bottom:6px }
.mb-8{ margin-bottom:8px }
.mb-12{ margin-bottom:12px }
.my-4{ margin:4px 0 }
.my-6{ margin:6px 0 }
.pl-24{ padding-left:24px }
.pl-18{ padding-left:18px }
.justify-between{ justify-content:space-between }
.wrap{ flex-wrap:wrap }
/* Display/Flex helpers */
.flex{ display:flex }
.items-center{ align-items:center }
.col{ flex-direction:column }
/* Padding helpers */
.p-16{ padding:16px }
.pb-10{ padding-bottom:10px }
/* Opacity */
.op-70{ opacity:.7 }
/* Text */
.text-12{ font-size:12px }
.text-28{ font-size:28px }
.fw-700{ font-weight:700 }
.block{ display:block }

/* Width / sizing utilities */
.w-full{ width:100% }
.w-20{ width:20px }
.w-40{ width:40px }
.w-80{ width:80px }
.w-180{ width:180px }
.w-200{ width:200px }
.flex-1{ flex:1 }
.minw-120{ min-width:120px }
.muted{ color: var(--muted) }
.clickable{ cursor: pointer }
.underline{ text-decoration: underline }
.scroll-area{ overflow:auto }
.maxh-70{ max-height:70vh }
.maxh-38vh{ max-height:38vh }
.minh-70{ min-height:70px }
.minh-100{ min-height:100px }
.minh-120{ min-height:120px }
/* Custom width helpers */
.w-90{ width:90px }

/* Table helpers */
.grid{ width:100% }
.grid td, .grid th{ padding:8px; border-bottom:1px solid var(--border) }
.grid th{ text-align:left }
.caret{ display:inline-block; width:16px; text-align:center; margin-right:6px; cursor:pointer; user-select:none }

/* Views show/hide (replaces JS inline display) */
.view{ display:none }
.view.show{ display:block }

/* Board dynamic columns via attribute (replaces JS inline gridTemplateColumns) */
.board[data-cols="1"]{ grid-template-columns: repeat(1, minmax(260px,1fr)) }
.board[data-cols="2"]{ grid-template-columns: repeat(2, minmax(260px,1fr)) }
.board[data-cols="3"]{ grid-template-columns: repeat(3, minmax(260px,1fr)) }
.board[data-cols="4"]{ grid-template-columns: repeat(4, minmax(260px,1fr)) }
.board[data-cols="5"]{ grid-template-columns: repeat(5, minmax(260px,1fr)) }
.board[data-cols="6"]{ grid-template-columns: repeat(6, minmax(260px,1fr)) }
.board[data-cols="7"]{ grid-template-columns: repeat(7, minmax(260px,1fr)) }
.board[data-cols="8"]{ grid-template-columns: repeat(8, minmax(260px,1fr)) }
.board[data-cols="9"]{ grid-template-columns: repeat(9, minmax(260px,1fr)) }
.board[data-cols="10"]{ grid-template-columns: repeat(10, minmax(260px,1fr)) }
.board[data-cols="11"]{ grid-template-columns: repeat(11, minmax(260px,1fr)) }
.board[data-cols="12"]{ grid-template-columns: repeat(12, minmax(260px,1fr)) }

/* Confetti variants (remove inline styles from JS) */
.confetti i{ animation-name: fall; animation-timing-function: cubic-bezier(.4,.8,.6,1); animation-fill-mode: forwards }
/* Colors */
.cf-c0{ background:#34d399 }
.cf-c1{ background:#60a5fa }
.cf-c2{ background:#fbbf24 }
.cf-c3{ background:#f87171 }
.cf-c4{ background:#a78bfa }
/* Horizontal positions (0%..95% step 5) */
.cf-x0{ left:0% } .cf-x5{ left:5% } .cf-x10{ left:10% } .cf-x15{ left:15% } .cf-x20{ left:20% }
.cf-x25{ left:25% } .cf-x30{ left:30% } .cf-x35{ left:35% } .cf-x40{ left:40% } .cf-x45{ left:45% }
.cf-x50{ left:50% } .cf-x55{ left:55% } .cf-x60{ left:60% } .cf-x65{ left:65% } .cf-x70{ left:70% }
.cf-x75{ left:75% } .cf-x80{ left:80% } .cf-x85{ left:85% } .cf-x90{ left:90% } .cf-x95{ left:95% }
/* Initial rotations */
.cf-rot0{ transform: translateY(-10px) rotate(0deg) }
.cf-rot30{ transform: translateY(-10px) rotate(30deg) }
.cf-rot60{ transform: translateY(-10px) rotate(60deg) }
.cf-rot90{ transform: translateY(-10px) rotate(90deg) }
.cf-rot120{ transform: translateY(-10px) rotate(120deg) }
.cf-rot150{ transform: translateY(-10px) rotate(150deg) }
.cf-rot180{ transform: translateY(-10px) rotate(180deg) }
.cf-rot210{ transform: translateY(-10px) rotate(210deg) }
.cf-rot240{ transform: translateY(-10px) rotate(240deg) }
.cf-rot270{ transform: translateY(-10px) rotate(270deg) }
.cf-rot300{ transform: translateY(-10px) rotate(300deg) }
.cf-rot330{ transform: translateY(-10px) rotate(330deg) }
/* Durations (1.3s .. 2.7s) */
.cf-dur1{ animation-duration:1.30s } .cf-dur2{ animation-duration:1.46s } .cf-dur3{ animation-duration:1.62s } .cf-dur4{ animation-duration:1.78s } .cf-dur5{ animation-duration:1.94s }
.cf-dur6{ animation-duration:2.10s } .cf-dur7{ animation-duration:2.26s } .cf-dur8{ animation-duration:2.42s } .cf-dur9{ animation-duration:2.58s } .cf-dur10{ animation-duration:2.74s }
/* Delays (0s .. 0.4s) */
.cf-delay0{ animation-delay:0s } .cf-delay1{ animation-delay:.05s } .cf-delay2{ animation-delay:.10s } .cf-delay3{ animation-delay:.15s } .cf-delay4{ animation-delay:.20s }
.cf-delay5{ animation-delay:.25s } .cf-delay6{ animation-delay:.30s } .cf-delay7{ animation-delay:.35s } .cf-delay8{ animation-delay:.40s }

/* Toast component */
.toast{ position:fixed; right:16px; bottom:16px; background:var(--panel); border:1px solid var(--border); box-shadow:var(--shadow); padding:10px 14px; border-radius:12px; z-index:99999; max-width:360px; transition: opacity .3s, transform .3s }
.toast.fade-out{ opacity:0; transform: translateY(6px) }

/* Popup menu (theme selector) */
.menu-popup{ position:fixed; background:var(--panel); border:1px solid var(--hairline); border-radius:10px; box-shadow:var(--elev-1); padding:6px; z-index:10001; display:grid; gap:6px }

/* Command Palette */
.cmd-overlay{ position:fixed; inset:0; z-index:3600; display:flex; align-items:flex-start; justify-content:center; background:rgba(0,0,0,.35) }
.cmd-box{ margin-top:12vh; min-width:min(720px,94vw); background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); overflow:hidden }
.cmd-input{ width:100%; padding:12px 14px; background:var(--panel-2); border:none; border-bottom:1px solid var(--border); color:var(--text); font-size:15px; outline:none }
.cmd-list{ max-height:50vh; overflow:auto; padding:6px }
.cmd-item{ display:flex; gap:8px; align-items:center; width:100%; text-align:left; background:transparent; border:1px solid var(--hairline); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer; margin:4px 0 }
.cmd-item.active{ outline:2px solid var(--primary); outline-offset:1px; background:rgba(255,255,255,.03) }

/* Timeline (Home view) */
.timeline{ position:relative; border-left:1px solid var(--border) }
.slot{ position:absolute; left:0; right:0; height:48px }
/* Calendar layout (Home view) */
.cal-grid{ display:grid; grid-template-columns:80px 1fr; gap:8px; max-height:70vh; overflow:auto }
.hours{ display:block }
.hour{ height:48px; display:flex; align-items:center }
.timeline .event{ position:absolute; left:8px; right:8px }

/* Emoji Picker */
.emoji-picker{ position:fixed; z-index:3700; background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:8px; max-width:320px; max-height:260px; overflow:auto; display:none; grid-template-columns:repeat(10,1fr); gap:6px }
.emoji-picker.open{ display:grid }
.emoji-btn{ font-size:18px; border:none; background:transparent; cursor:pointer; line-height:1.2 }

/* Sidebar helpers */
.sidebar-summary{ cursor:pointer; color:var(--muted); font-size:12px }
.muted-note{ color:var(--muted); font-size:12px }

/* Comment/media thumbnails */
.thumb-64x48{ width:64px; height:48px; object-fit:cover; border-radius:6px; border:1px solid var(--border) }
.thumb-80x60{ width:80px; height:60px; object-fit:cover; border-radius:6px; border:1px solid var(--border) }
.video-thumb{ width:160px; max-width:100%; border-radius:8px; border:1px solid var(--border) }

/* ============== Summary ============== */
.cards{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:12px}
.progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden}
.progress > div{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent))}
.progress-thin{ height:4px }
/* Discrete width percentages (5% steps) */
.wp-0{ width:0% } .wp-5{ width:5% } .wp-10{ width:10% } .wp-15{ width:15% } .wp-20{ width:20% }
.wp-25{ width:25% } .wp-30{ width:30% } .wp-35{ width:35% } .wp-40{ width:40% } .wp-45{ width:45% }
.wp-50{ width:50% } .wp-55{ width:55% } .wp-60{ width:60% } .wp-65{ width:65% } .wp-70{ width:70% }
.wp-75{ width:75% } .wp-80{ width:80% } .wp-85{ width:85% } .wp-90{ width:90% } .wp-95{ width:95% }
.wp-100{ width:100% }
.bar{height:12px;background:linear-gradient(180deg,var(--primary),var(--accent));border-radius:10px;position:relative}
.tooltip{position:absolute;left:50%;top:-34px;transform:translateX(-50%);background:var(--panel);border:1px solid var(--border);padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap;display:none}
.bar:hover .tooltip{display:block}
/* Bars/labels grid (Summary) */
.bars-grid{ display:grid; align-items:end; min-height:180px; gap:10px }
.labels-grid{ display:grid; gap:10px; margin-top:6px }
.text-center{ text-align:center }
/* Dynamic columns via attribute */
.bars-grid[data-cols="1"], .labels-grid[data-cols="1"]{ grid-template-columns: repeat(1, 1fr) }
.bars-grid[data-cols="2"], .labels-grid[data-cols="2"]{ grid-template-columns: repeat(2, 1fr) }
.bars-grid[data-cols="3"], .labels-grid[data-cols="3"]{ grid-template-columns: repeat(3, 1fr) }
.bars-grid[data-cols="4"], .labels-grid[data-cols="4"]{ grid-template-columns: repeat(4, 1fr) }
.bars-grid[data-cols="5"], .labels-grid[data-cols="5"]{ grid-template-columns: repeat(5, 1fr) }
.bars-grid[data-cols="6"], .labels-grid[data-cols="6"]{ grid-template-columns: repeat(6, 1fr) }
.bars-grid[data-cols="7"], .labels-grid[data-cols="7"]{ grid-template-columns: repeat(7, 1fr) }
.bars-grid[data-cols="8"], .labels-grid[data-cols="8"]{ grid-template-columns: repeat(8, 1fr) }
.bars-grid[data-cols="9"], .labels-grid[data-cols="9"]{ grid-template-columns: repeat(9, 1fr) }
.bars-grid[data-cols="10"], .labels-grid[data-cols="10"]{ grid-template-columns: repeat(10, 1fr) }
.bars-grid[data-cols="11"], .labels-grid[data-cols="11"]{ grid-template-columns: repeat(11, 1fr) }
.bars-grid[data-cols="12"], .labels-grid[data-cols="12"]{ grid-template-columns: repeat(12, 1fr) }
/* Discrete height levels for bars (0..10) */
.bar.h-lv0{ height:10px }
.bar.h-lv1{ height:22px }
.bar.h-lv2{ height:34px }
.bar.h-lv3{ height:46px }
.bar.h-lv4{ height:58px }
.bar.h-lv5{ height:70px }
.bar.h-lv6{ height:94px }
.bar.h-lv7{ height:118px }
.bar.h-lv8{ height:142px }
.bar.h-lv9{ height:166px }
.bar.h-lv10{ height:180px }
.bar.today{ outline:2px solid var(--accent) }

/* ============== Confetti / Mega ============== */
.confetti{position:fixed;top:-10px;left:0;width:100%;pointer-events:none;z-index:3450}
.confetti i{position:absolute;width:10px;height:14px;background:var(--primary);opacity:.9;will-change:transform,opacity;border-radius:2px}
@keyframes fall{to{transform:translateY(105vh) rotate(720deg);opacity:.9}}

.mega{position:fixed;inset:0;display:none;place-items:center;z-index:3550;background:rgba(0,0,0,.5)}
.mega.show{display:grid}
.mega .inner{max-width:min(900px,92vw);text-align:center;padding:28px 22px;border-radius:16px;
  color:#fff;font-weight:900;letter-spacing:.3px;
  background:radial-gradient(1200px 400px at 50% 50%, rgba(96,165,250,.25), rgba(167,139,250,.18) 60%, transparent 80%),
             linear-gradient(135deg, rgba(96,165,250,.95), rgba(167,139,250,.95));
  box-shadow:0 20px 70px rgba(0,0,0,.55); 
  font-size:clamp(26px, 5.6vw, 62px);
  animation:pop .45s cubic-bezier(.2,.9,.2,1) both;
  position:relative;
}
.mega .close{position:absolute;right:10px;top:10px;background:rgba(0,0,0,.25);border:none;color:white;border-radius:8px;padding:6px 10px;cursor:pointer}
@keyframes pop{0%{transform:scale(.92);opacity:0}70%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}}

/* ============== Footer ============== */
footer{padding:30px;color:var(--muted);text-align:center}

/* ============== Responsive layout tweaks ============== */
@media (max-width: 980px){
  .board{grid-template-columns:1fr}
  .docs{grid-template-columns:1fr}
  .sheet{grid-template-columns:1fr}
  .cards{grid-template-columns:1fr 1fr}
  .view-flex{grid-template-columns:1fr}
  .main-grid{grid-template-columns:1fr}
  #projectsSidebar{position:static;max-height:none}
  .search-wrap .key, .search-wrap .plus{ display:none; }
  #expandSearch{ display:none; }
  .subbar .tabs-wrap{ mask-image: linear-gradient(to right, transparent 0, black 10px, black calc(100% - 10px), transparent 100%); }
}

/* ============== AI orb & Drawer ============== */
.ai-btn{ position:relative; overflow:hidden }
.ai-btn::before{
  content:""; position:absolute; inset:-20%; background: radial-gradient(120% 120% at 20% 10%, rgba(96,165,250,.25), rgba(167,139,250,.25), transparent 60%);
  opacity:.25; transition: transform .2s ease, opacity .2s ease; transform: translateY(6%);
}
.ai-btn:hover::before{ opacity:.4; transform: translateY(0%) }

.ai-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:3500; display:block }
.ai-drawer{ position:fixed; right:-560px; top:0; bottom:0; width:min(520px, 92vw); background:var(--panel); border-left:1px solid var(--hairline); box-shadow:var(--elev-1); display:flex; flex-direction:column; transition:right .18s ease; z-index:3600 }
.ai-drawer.show{ right:0 }
.ai-head{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid var(--hairline); background: linear-gradient(180deg, rgba(255,255,255,.04), transparent) }
.ai-head h3{ margin:0; font-weight:800 }
.ai-head .spacer{ flex:1 }
.ai-quick{ display:flex; gap:6px; padding:8px 10px; border-bottom:1px dashed var(--hairline) }
.ai-quick .chip{ padding:6px 10px; border-radius:999px; border:1px solid var(--hairline); background:rgba(255,255,255,.03); color:var(--text); cursor:pointer }
.ai-quick .chip:hover{ background:rgba(255,255,255,.06) }
.ai-body{ flex:1; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px }
.ai-body .msg{ display:flex }
.ai-body .msg.user{ justify-content:flex-end }
.ai-body .bubble{ max-width:76%; padding:8px 10px; border-radius:12px; border:1px solid var(--hairline); background:var(--card) }
.ai-body .msg.user .bubble{ background: linear-gradient(180deg, var(--primary), var(--accent)); color:#fff; border:none }
.ai-input{ display:flex; gap:8px; padding:10px; border-top:1px solid var(--hairline); background:var(--panel-2) }
.ai-input textarea{ flex:1; min-height:38px; max-height:180px; resize:vertical; border:1px solid var(--border); border-radius:10px; background:var(--panel); color:var(--text); padding:8px }
.ai-input textarea:focus{ outline:2px solid var(--primary); outline-offset:2px }
.ai-head #aiMicBtn.on{ box-shadow: 0 0 0 1px var(--primary) inset, 0 0 12px color-mix(in oklab, var(--primary), transparent 60%); border-color: var(--primary) }

/* ============== Minor polish (radii / spacing) ============== */
:root{ --radius:12px; --pad:8px; --fontScale:100% }
body{ font-size: var(--fontScale) }
.btn{ padding: calc(var(--pad) - 2px) calc(var(--pad) + 4px); border-radius: var(--radius) }
input, select, textarea{ padding: var(--pad); border-radius: calc(var(--radius) - 2px) }
.tab{ border-radius: var(--radius) }
#projectsSidebar{ border-radius: var(--radius) }
.column{ border-radius: var(--radius) }
.dropzone{ border-radius: calc(var(--radius) - 2px) }
.task{ border-radius: calc(var(--radius) + 2px) }
.chip, .tag{ background: linear-gradient(180deg, rgba(255,255,255,.04), transparent) }

/* Tag input */
.tagbox{display:flex;gap:6px;flex-wrap:wrap;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px}
.tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);padding:3px 8px;border-radius:999px}
.tag .x{cursor:pointer;opacity:.7}
.tagbox input{border:none;outline:none;background:transparent;padding:4px 6px;min-width:100px}

/* Dialog (task card) */
dialog{border:none;border-radius:18px;background:var(--panel);color:var(--text);box-shadow:var(--shadow);width:min(860px,95vw)}
dialog::backdrop{background:rgba(0,0,0,.45)}
.sheet{display:grid;grid-template-columns:1.3fr .7fr;gap:14px}
.sheet-head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.dot{width:10px;height:10px;border-radius:50%;background:var(--primary)}
.h-title{font-size:22px;font-weight:800;margin:0}
.meta-bar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.meta-bar .chip{border-radius:999px}
.aside{border-left:1px solid var(--border);padding-left:10px;display:grid;gap:8px}
.inline-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.r{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.r.gap-6{ gap:6px }
.sub-list{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.sub-row{display:flex;gap:8px;align-items:center}
.sub-row input[type="text"]{flex:1}
.footer-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Misc helpers for start pill */
.task[data-start] .meta::after{ order:0 }
.start-pill{ position:relative }
.start-pill::before{ content:"Inicio"; font-weight:600; color:var(--text); margin-right:4px; opacity:.9 }

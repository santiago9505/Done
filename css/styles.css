:root{
  --bg:#0c1118; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937;
  --primary:#7aa2ff; --success:#34d399; --warning:#fbbf24; --danger:#f87171; --accent:#a78bfa;
  --card:#0b1220; --shadow:0 10px 24px rgba(0,0,0,.35);
  --ok:#34d399; --warn:#fbbf24; --hairline:rgba(148,163,184,.18);
}
html[data-theme="light"]{
  --bg:#f6f7fb; --panel:#ffffff; --panel-2:#f8fafc; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --hairline:rgba(0,0,0,.08);
  --primary:#3b82f6; --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --accent:#8b5cf6;
  --card:#ffffff; --shadow:0 10px 20px rgba(0,0,0,.08);
}
/* New/updated design tokens (kept separate to not break existing usages) */
:root{
  --bg:#0b1020; --panel:#0f172a; --panel-2:#0c1426;
  --text:#e7eaf3; --muted:#96a0b5; --border:#1e293b; --hairline:rgba(148,163,184,.22);
  --primary:#8b5cf6; --primary-600:#7c3aed; --success:#22c55e; --warning:#f59e0b; --danger:#ef4444; --info:#60a5fa;
  --card:#0b1220; --elev-1:0 4px 18px rgba(2,6,23,.35);
  --radius-1:10px; --radius-2:14px; --radius-pill:999px;
  --space-1:8px; --space-2:12px; --space-3:16px; --space-4:24px;
  --font-sans: ui-sans-serif, Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif}
/* Accessibility-first defaults for typography and rendering */
html, body{
  font-family: var(--font-sans);
  color: var(--text);
  background: var(--bg);
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
header{position:sticky;top:0;background:linear-gradient(180deg, rgba(0,0,0,.08), transparent), var(--bg);backdrop-filter:saturate(1.1) blur(8px);z-index:20}
html[data-theme="light"] header{ background: linear-gradient(180deg, rgba(0,0,0,.04), transparent), var(--bg); }
.topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid var(--border)}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand .logo{width:28px;height:28px;border-radius:10px;
  background: radial-gradient(80% 80% at 30% 20%, rgba(255,255,255,.25), transparent 60%),
              linear-gradient(135deg,var(--primary),var(--accent));
  display:grid; place-items:center;
  transition: transform .2s ease;
}
/* Neutraliza el pseudo-elemento del logo para no superponer texto */
.brand .logo::after{
  content: none !important;
}
.brand .logo:hover{ transform: translateY(-1px) scale(1.02) }

.brand .app-name{
  font-weight:800;
  letter-spacing:.2px;
}
.bar-actions{display:flex;gap:10px;align-items:center}
.chip{padding:6px 10px;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:12px}
.btn{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;border:none}
.btn.success{background:linear-gradient(135deg,var(--success),#059669);color:white;border:none}
.btn.ghost{background:transparent;box-shadow:none}
input, select, textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px}
/* Improved focus styles for accessibility */
input:focus, select:focus, textarea:focus{outline:2px solid var(--primary);outline-offset:2px}
.search{min-width:260px}
.tabs{display:flex;gap:6px;align-items:center;padding:10px 16px;border-bottom:1px solid var(--border)}
.tab{padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted)}
.tab.active{color:var(--text);background:var(--panel);box-shadow:var(--shadow)}
main{padding:16px;max-width:1400px;margin:0 auto}
.main-grid{display:grid;grid-template-columns:260px 1fr;gap:14px;align-items:start}
#projectsSidebar{position:sticky;top:96px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:10px;box-shadow:var(--shadow);max-height:75vh;overflow:auto}
#projectsSidebar .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
#projectsSidebar .proj-list{display:flex;flex-direction:column;gap:6px}
#projectsSidebar .proj{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px solid var(--border);border-radius:10px;padding:6px 8px;cursor:pointer}
#projectsSidebar .proj.active{outline:2px solid var(--primary)}
#projectsSidebar .proj .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#projectsSidebar .proj .x{opacity:.7;cursor:pointer}
#projectsSidebar .create{display:flex;gap:6px;margin-top:8px}
/* Favoritos zona */
.fav-zone{display:flex;flex-direction:column;gap:6px;padding:4px;border:1px dashed var(--hairline);border-radius:10px;min-height:38px}
.fav-zone .proj{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent)}

.view-flex{display:grid;grid-template-columns:1.4fr .9fr;gap:12px}

.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;box-shadow:var(--shadow)}
.h{font-weight:800;margin:0 0 8px 0}

/* Board */
.board{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:14px}
.column{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;min-height:260px;display:flex;flex-direction:column}
.col-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.col-title{font-weight:700}
.dropzone{flex:1;display:flex;flex-direction:column;gap:10px;padding:4px;border-radius:12px;min-height:160px}
.dropzone.drag{outline:2px dashed var(--primary)}
.task{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;box-shadow:var(--shadow);cursor:grab;position:relative}
.task header{display:flex;justify-content:space-between;align-items:center}
.task h4{margin:0;font-size:14px;cursor:pointer}
.task .meta{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:12px;margin-top:6px;flex-wrap:wrap}
.task .meta .start-date{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:2px 8px;
  border:1px solid var(--border);
  border-radius:999px;
  font-size:11px;
  color:var(--muted);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.task .meta .start-date::before{
  content:"Inicio";
  color:var(--text);
  font-weight:600;
  margin-right:2px;
}

/* Auto-inject pill si SOLO existe el atributo (no elemento explícito) */
.task[data-start] .meta:not(:has(.start-date))::after,
.task[data-start-date] .meta:not(:has(.start-date))::after,
.task[data-startDate] .meta:not(:has(.start-date))::after,
.task[data-inicio] .meta:not(:has(.start-date))::after{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:2px 8px;
  border:1px solid var(--border);
  border-radius:999px;
  font-size:11px;
  color:var(--muted);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  font-weight:400;
}

/* Contenido específico según atributo presente */
.task[data-start] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start) }
.task[data-start-date] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-start-date) }
.task[data-startDate] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-startDate) }
.task[data-inicio] .meta:not(:has(.start-date))::after{ content:"Inicio " attr(data-inicio) }

.icons{display:flex;gap:6px}
.row-actions{position:absolute;right:8px;bottom:8px;opacity:0;transition:opacity .15s}
.task:hover .row-actions{opacity:1}

/* Tablas: filas cerradas */
tr.closed td{ color: var(--muted); background: linear-gradient(180deg, rgba(16,185,129,.08), transparent); }
tr.closed td:first-child{ position: relative }
tr.closed td:first-child::before{ content:''; position:absolute; left:8px; top:50%; width:8px; height:8px; background:var(--success); border-radius:50%; transform:translateY(-50%)}

/* =================== Modern App Header =================== */
.app-header{
  position: sticky; top:0; z-index:1000;
  display:grid; grid-template-columns: 1fr minmax(360px,720px) 1fr; gap: var(--space-3);
  align-items:center; padding: 10px 24px; height:56px; box-sizing:border-box;
  background: linear-gradient(180deg, rgba(16,23,42,.7), rgba(16,23,42,.35)) , var(--panel);
  -webkit-backdrop-filter: saturate(1.2) blur(8px);
  backdrop-filter: saturate(1.2) blur(8px);
  border-bottom: 1px solid var(--hairline);
  box-shadow: inset 0 -1px 0 rgba(255,255,255,.04);
}
html[data-theme="light"] .app-header{ background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.0)), var(--panel); }
.h-left,.h-center,.h-right{ display:flex; align-items:center; gap: var(--space-2); }
.logo-btn{ display:flex; align-items:center; gap:10px; color:var(--text); background:transparent; border:0; cursor:pointer; padding:6px 10px; border-radius: var(--radius-1); }
.logo-btn:hover{ background: rgba(255,255,255,.03); }
.brand{ font-weight:700; letter-spacing:.2px; }
.badge{ font-size:12px; padding:2px 8px; border-radius: var(--radius-pill); background: rgba(139,92,246,.2); color: var(--primary); border:1px solid rgba(139,92,246,.35); }

.context-chip{
  padding:6px 10px; border-radius: var(--radius-pill);
  border:1px solid var(--hairline); color:var(--muted); background: rgba(255,255,255,.02);
}

.kbd-hint{ border:1px solid var(--hairline); background:rgba(255,255,255,.03); border-radius: var(--radius-1); padding:6px; display:flex; }
.kbd-hint:hover{ background: rgba(255,255,255,.06); }

.search-wrap{
  position:relative; flex:1; display:flex; align-items:center;
  background: var(--panel-2); border:1px solid var(--border);
  border-radius: var(--radius-2); padding: 6px 12px; gap:8px; min-height:40px;
  box-shadow: var(--elev-1);
}
.search-wrap input{
  background:transparent; border:0; color:var(--text); width:100%;
  font-size:14px; outline:none;
}
.search-wrap .key{
  font-size:12px; padding:2px 6px; border-radius:6px; border:1px solid var(--hairline); color:var(--muted);
}
.search-wrap .plus{ color:var(--muted); font-size:12px; margin:0 2px; }

.icon-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px; height:40px; border-radius:10px; border:1px solid var(--hairline);
  background:rgba(255,255,255,.03); color:var(--text);
  opacity:.92; transition:opacity .12s ease, background-color .12s ease, border-color .12s ease;
}
.icon-btn:hover{ background:rgba(255,255,255,.06); opacity:1; }
.icon-btn svg{ width:18px; height:18px; }
.icon-btn:focus-visible{ outline:2px solid var(--primary); outline-offset:2px; }

.user-menu{ position:relative; }
.user-pill{
  display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius: var(--radius-pill);
  border:1px solid var(--hairline); background: rgba(255,255,255,.03); color:var(--text);
}
.user-pill .dot{ width:8px; height:8px; border-radius:50%; background: var(--success); }
.user-pill .u-name{ font-weight:600; }
.user-pill .u-xp{ color:var(--muted); font-size:12px; }
.user-menu .menu{
  position:absolute; right:0; top:calc(100% + 8px); background: var(--panel);
  border:1px solid var(--hairline); border-radius: var(--radius-1); min-width:220px; padding:6px;
  box-shadow: var(--elev-1);
}
.user-menu .menu[hidden]{ display:none; }
.user-menu .menu button{
  width:100%; text-align:left; padding:10px 12px; border-radius:8px; background:transparent; border:0; color:var(--text);
}
.user-menu .menu button:hover{ background: rgba(255,255,255,.06); }

@media (max-width: 980px){
  .app-header{ grid-template-columns: 1fr 1.2fr auto; gap: var(--space-2); padding: 8px 24px; height:56px; }
  .badge, .u-xp{ display:none; }
}
@media (max-width: 720px){
  .context-chip{ display:none; }
  .search-wrap .key, .search-wrap .plus{ display:none; }
}

/* =================== Sticky Subbar Navigation =================== */
.subbar{
  position: sticky; top:58px; z-index: 900;
  display:flex; gap:6px; align-items:center; justify-content:space-between;
  padding:6px var(--space-4);
  background: linear-gradient(180deg, rgba(16,23,42,.45), rgba(16,23,42,.15)), var(--panel);
  -webkit-backdrop-filter: saturate(1.1) blur(6px);
  backdrop-filter: saturate(1.1) blur(6px);
  border-bottom: 1px solid var(--hairline);
}
html[data-theme="light"] .subbar{ background: linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.0)), var(--panel); }
.subbar .tabs-wrap{ display:flex; gap:6px; align-items:center }
.subbar .tab-btn{
  border:1px solid var(--hairline);
  background: rgba(255,255,255,.02);
  color: var(--text);
  padding:6px 10px;
  border-radius: var(--radius-1);
  font-size: 13px;
  cursor: pointer;
}
.subbar .tab-btn:hover{ background: rgba(255,255,255,.06); }
.subbar .tab-btn[aria-current="page"]{
  border-color: var(--primary);
  box-shadow: inset 0 0 0 1px var(--primary);
}
.subbar .sub-actions{ display:flex; gap:8px; align-items:center }

/* Tag input */
.tagbox{display:flex;gap:6px;flex-wrap:wrap;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px}
.tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);padding:3px 8px;border-radius:999px}
.tag .x{cursor:pointer;opacity:.7}
.tagbox input{border:none;outline:none;background:transparent;padding:4px 6px;min-width:100px}

/* Dialog (task card) */
dialog{border:none;border-radius:18px;background:var(--panel);color:var(--text);box-shadow:var(--shadow);width:min(860px,95vw)}
dialog::backdrop{background:rgba(0,0,0,.45)}
.sheet{display:grid;grid-template-columns:1.3fr .7fr;gap:14px}
.sheet-head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.dot{width:10px;height:10px;border-radius:50%;background:var(--primary)}
.h-title{font-size:22px;font-weight:800;margin:0}
.meta-bar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.meta-bar .chip{border-radius:999px}
.aside{border-left:1px solid var(--border);padding-left:10px;display:grid;gap:8px}
.inline-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.r{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.sub-list{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.sub-row{display:flex;gap:8px;align-items:center}
.sub-row input[type="text"]{flex:1}
.footer-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Docs */
.docs{display:grid;grid-template-columns:280px 1fr;gap:12px}
.tree{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:8px;max-height:70vh;overflow:auto}
.tree ul{list-style:none;padding-left:12px}
.tree li{margin:4px 0}
.tree .node{display:flex;align-items:center;gap:6px}
.doc-editor{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
.ribbon{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px 0}
.rich{min-height:320px;border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card);outline:none}
.rich img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
.cmd{position:absolute;background:var(--panel);border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);padding:6px;display:none;z-index:50}
.cmd button{display:block;width:100%;text-align:left;border:none;background:transparent;padding:6px 8px;cursor:pointer}
.cmd button:hover{background:var(--card)}

/* Summary */
.cards{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:12px}
.progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden}
.progress > div{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent))}
.bar{height:12px;background:linear-gradient(180deg,var(--primary),var(--accent));border-radius:10px;position:relative}
.tooltip{position:absolute;left:50%;top:-34px;transform:translateX(-50%);background:var(--panel);border:1px solid var(--border);padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap;display:none}
.bar:hover .tooltip{display:block}

/* Confetti */
.confetti{position:fixed;top:-10px;left:0;width:100%;pointer-events:none;z-index:9999}
.confetti i{position:absolute;width:10px;height:14px;background:var(--primary);opacity:.9;will-change:transform,opacity;border-radius:2px}
@keyframes fall{to{transform:translateY(105vh) rotate(720deg);opacity:.9}}

/* Mega (center) */
.mega{position:fixed;inset:0;display:none;place-items:center;z-index:10000;background:rgba(0,0,0,.5)}
.mega.show{display:grid}
.mega .inner{max-width:min(900px,92vw);text-align:center;padding:28px 22px;border-radius:16px;
  color:white;font-weight:900;letter-spacing:.3px;
  background:radial-gradient(1200px 400px at 50% 50%, rgba(96,165,250,.25), rgba(167,139,250,.18) 60%, transparent 80%),
             linear-gradient(135deg, rgba(96,165,250,.95), rgba(167,139,250,.95));
  box-shadow:0 20px 70px rgba(0,0,0,.55); 
  font-size:clamp(26px, 5.6vw, 62px);
  animation:pop .45s cubic-bezier(.2,.9,.2,1) both;
  position:relative;
}
.mega .close{position:absolute;right:10px;top:10px;background:rgba(0,0,0,.25);border:none;color:white;border-radius:8px;padding:6px 10px;cursor:pointer}
@keyframes pop{0%{transform:scale(.92);opacity:0}70%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}}

footer{padding:30px;color:var(--muted);text-align:center}

@media (max-width: 980px){
  .board{grid-template-columns:1fr}
  .docs{grid-template-columns:1fr}
  .sheet{grid-template-columns:1fr}
  .cards{grid-template-columns:1fr 1fr}
  .view-flex{grid-template-columns:1fr}
  .main-grid{grid-template-columns:1fr}
  #projectsSidebar{position:static;max-height:none}
}

/* Modern tokens and light polish (non-breaking) */
:root{ --radius:12px; --pad:8px; --fontScale:100% }
body{ font-size: var(--fontScale) }
.btn{ padding: calc(var(--pad) - 2px) calc(var(--pad) + 4px); border-radius: var(--radius); transition:transform .12s ease, background .2s, border-color .2s }
input, select, textarea{ padding: var(--pad); border-radius: calc(var(--radius) - 2px) }
.tab{ border-radius: var(--radius) }
#projectsSidebar{ border-radius: var(--radius) }
.column{ border-radius: var(--radius) }
.dropzone{ border-radius: calc(var(--radius) - 2px) }
.task{ border-radius: calc(var(--radius) + 2px) }
.card{ background: linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--panel) }
.chip, .tag{ background: linear-gradient(180deg, rgba(255,255,255,.04), transparent) }

/* Accesibilidad y motion */
*:focus-visible{ outline:2px solid var(--primary); outline-offset:2px }
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{ animation: none !important; transition: none !important }
}

/* Smooth theme transitions */
*{ transition: background-color .12s ease, color .12s ease, border-color .12s ease; }
@media (prefers-reduced-motion: reduce){ *{ transition: none !important } }

/* Asegura que el pill de inicio aparezca de forma consistente */
.task[data-start] .meta::after{
  /* ya definido antes si usas :not(:has(.start-date)); este refuerzo asegura orden */
  order:0;
}

.start-pill{ position:relative }
.start-pill::before{
  content:"Inicio";
  font-weight:600;
  color:var(--text);
  margin-right:4px;
  opacity:.9;
}

/* ---- Closed state visuals ---- */
.task.closed{opacity:.85;border-color:rgba(16,185,129,.35);box-shadow:inset 0 0 0 2px rgba(16,185,129,.25)}
.task.closed header h4::after{content:' ✔'; color:var(--success); font-weight:700}
/* Tablas: filas cerradas */
tr.closed td{ color: var(--muted); background: linear-gradient(180deg, rgba(16,185,129,.08), transparent); }
tr.closed td:first-child{ position: relative }
tr.closed td:first-child::before{ content:''; position:absolute; left:8px; top:50%; width:8px; height:8px; background:var(--success); border-radius:50%; transform:translateY(-50%)}

/* ====== Logo & Branding (light/dark variants) ====== */
[data-theme="dark"]{
  --logo-start:#8b5cf6; /* violet-500 */
  --logo-end:#60a5fa;   /* sky-400 */
  --logo-text:#e5e7eb;  /* gray-200 */
}
html[data-theme="light"]{
  --logo-start:#7c3aed; /* violet-600 */
  --logo-end:#3b82f6;   /* blue-500 */
  --logo-text:#111827;  /* gray-900 */
}
.app-header .logo-btn{ min-height:44px; min-width:44px; }
.app-header .logo-btn:focus-visible{ outline:2px solid var(--primary); outline-offset:2px; }
.app-header .wordmark{ font-weight:600; color: var(--logo-text); }
.app-header .badge{ padding:2px 6px;border-radius:999px;border:1px solid var(--hairline); font-size:12px; opacity:.9 }
.app-header .logo-svg .check{ transform-origin:12px 12px; transition: transform .2s ease, translate .2s ease; }
.app-header .logo-btn:hover .logo-svg .check{ transform: rotate(8deg) translateY(-1px); }
